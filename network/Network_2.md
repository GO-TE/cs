# Network 2.

---

혼공 Network2

---

# 물리 계층과 데이터 링크 계층

## 2-1 이더넷

물리 계층과 데이터 링크 계층은 이더넷이라는 공통된 기술을 사용해서 연관이 깊음

이더넷 : 다양한 통신 매체의 규격들과 송수신되는 프레임의 형태, 프레임을 주고 받는 방법 등이 정의된 네트워크 기술

유선 LAN 환경에서 가장 대중적으로 사용함

ex ) 두 호스트가 존재 - 이 호스트끼리 정보를 주고 받으려면 케이블과 같은 통신 매체, 정해진 송수신 방법이 필요함

### 이더넷 표준

유선 LAN 대부분 이더넷으로 구성됨 : 국제 표준화 IEEE 802.3

이더넷 표준에 따라 지원되는 네트워크 장비, 통신 매체의 종류와 전송 속도가 달라질 수 있음

### 통신 매체 표기 형태

이더넷에 따라 구현된 통신 매체 표기 형태를 알아보자

`전송속도` BASE - `추가특성` 과 같은 형태로 되어있음

1. 전송속도
    
    숫자만 표기 : Mbps
    
    숫자 뒤에 G : Gbps
    
    ex) 100Base_T 케이블은 100Mbps를 지원
    
2. BASE
    
    BASEband의 약자 : 변조 타입을 의미 : 비트 신호로 변환된 데이터를 통신 매체로 전송하는 방법
    
3. 추가 특성
    
    통신 매체의 특성을 명시
    
    `전송 가능 최대 거리` - 10BASE-2, 10BASE-5 처럼
    
    `물리 계층 인코딩` - 데이터가 비트 신호로 변환되는 방식
    
    `레인 수` - 비트 신호를 옮길 수 있는 전송로 수
    

### 통신 매체 종류

가장 대중적인 것만 다룸

C : 동축 케이블

T : 트위스티드 페어 케이블

S : 단파장 광섬유 케이블

L : 장파장 광섬유 케이블

항상 통신매체 표기가 일대일로 대응되진 않음

이제 케이블 이름으로 유추할 수 있는게 많아졌다

10BASE-T : 10Mbps의 트위스티드 페어 케이블

1000BASE-SX : 1000Mbps 단파장 광섬유 케이블

### 이더넷 프레임

호스트가 데이터 링크 계층에서 주고 받는 프레임 형식이 정해져 있음

상위 계층에서 캡슐화 된 정보로 만들어진다. 수신자 입장에서는 역캡슐화를 진행

![Untitled](Network%202%20351d02c5e4984476b0e08bcfc0dc72e3/Untitled.png)

헤더 : 프리앰블, 수신지 MAC 주소, 송신지 MAC 주소, 타입/길이

- 프리앰블
    
    이더넷 프레임의 시작을 알리는 정보 : 송수신지 간 동기화를 위해 사용
    
    첫 7바이트 10101010, 마지막 바이트 10101011
    
- MAC 주소
    
    물리적 주소라고도 함 (고유, 불변함) → 근데 중복되는 경우도 있는데 흔치 않음
    
    네트워크 인터페이스마다 부여되는 6바이트 길이의 주소로 LAN 내의 송수신지를 특정
    
    NIC 장치가 네트워크 인터페이스 역할을 담당
    
- 타입/길이
    
    필드에 명시된 크기가 1500이하일 경우 : 프레임의 크기(길이)를 나타냄
    
    필드의 명시된 크기가 1536 이상일 경우 : 프레임의 타입을 나타냄
    
    타입 : 어떤 정보를 캡슐화 했는지 나타내는 정보 (이더타입)
    
    0800 : IPv4, 86DD : IPv6 , 0806 : ARP
    

페이로드 : 데이터

- 데이터
    
    상위 계층에서 전달 받거나 상위 계층으로 전달해야 할 내용
    
    네트워크 계층의 데이터와 헤더를 합친 PDU가 이곳에 포함
    
    최소 46바이트 이상 최대 1500바이트
    
    최소보다 작다면 46바이트가 될떄까지 0으로 채움
    

트레일러 : FCS

- FCS
    
    수신한 이더넷 프레임에 오류가 있는지 확인하는 필드
    
    CRC (순환 중복 검사) 오류 검출용 값이 들어감
    
    송신자는 프리엠블을 제외한 나머지 필드값으로 CRC를 계산
    
    이 값을 FCS 필드에 명시
    
    수신자는 프리앰블과 FCS 필드를 제외한 필드값으로 CRC를 계산
    
    이 값을 FCS와 비교 → 일치 X 폐기함
    

![Untitled](Network%202%20351d02c5e4984476b0e08bcfc0dc72e3/Untitled%201.png)

### 토큰 링

이더넷 말고 LAN 기술, 토큰 링 이라는것도 있음

호스트끼리 링처럼 연결 되고 데이터를 보내려면 `토큰` 이 있어야 함

![A에게 토큰이 있으므로 B, C, D는 데이터를 전송하지 못함](Network%202%20351d02c5e4984476b0e08bcfc0dc72e3/Untitled%202.png)

A에게 토큰이 있으므로 B, C, D는 데이터를 전송하지 못함

---

## 2-2 NIC와 케이블

Network Interface Controller

NIC : 호스트와 통신 매체를 연결하고 MAC 주소가 부여되는 네트워크 장비

케이블 : NIC에 연결되는 물리 계층 유선 통신 매체

### NIC

통신 매체에는 전기, 빛 다양한 신호가 흐름

호스트가 이를 이해하려면 정보가 변환되야함 → 이를 연결하고 변환하는게 NIC임

NIC가 있어야 네트워크에 접속할 수 있음

LAN을 연결하기 위한 하드웨어라고 표현하기도 함

요즘은 거의 메인보드에 내장되어있음

근데 이 NIC의 역할이 무엇이냐

전에 언급했듯이, 네트워크 인터페이스 역할을 한다고 했는데, MAC 주소를 할당해준다고 했다. 그리고 “인터페이스마다” 할당 된다 : 인터페이스 ∝ MAC 주소

이 할당된 주소와 본인 NIC 주소도 인식하고, 수신받은 데이터의 주소가 잘못되어있다면

가차없이 폐기할 수 있다.

+) FCS필드로 오류를 검출해 폐기도 한다

### 트위스티드 페어 케이블

이더넷에서 나온 케이블 종류중 하나임

구리선으로 전기 신호를 주고 받는 케이블인데 LAN 케이블하면 가장 대중적임

### 광섬유 케이블

빛으로 신호를 주고 받는 케이블

빛이니까 빠르고 비교적 먼 거리까지 전송이 가능하다. (나라 - 나라)

> 종류와 구별법에 대해 설명하는데, 딱히.. 잘 모르겠음 이게 중요한가?
> 

---

## 2-3 허브

데이터 링크 계층은 MAC 주소가 있는데, 물리 계층은 주소 개념이 존재하지 않는다

주소개념이 없으니 수신된 메세지에 대한 컨트롤을 하지 않음 (폐기를 한다던가)

허브는 물리 계층의 대표적인 장비다

![[http://m.newstap.co.kr/news/articleView.html?idxno=108843](http://m.newstap.co.kr/news/articleView.html?idxno=108843)](Network%202%20351d02c5e4984476b0e08bcfc0dc72e3/image.png)

[http://m.newstap.co.kr/news/articleView.html?idxno=108843](http://m.newstap.co.kr/news/articleView.html?idxno=108843)

저기 연결 지점을 포트라고 부름 → 호스트와 연결된 통신매체와 연결

- 특징
    
    요즘 허브를 잘 쓰지는 않는다고 한다.
    
    1. 전달받은 신호를 다른 모든 포트로 그대로 보냄
        
        주소개념이 없기에 수신지를 특정하지 못함 → 그래서 다 보냄
        
        딱봐도 필요없는 작업이 느는게 보인다.
        
    2. 반이중 모드로 통신
        
        반이중 모드 : 1차선 도로처럼 송수신을 반복하는 1way 통신 방식
        
        동시에 송수신을 못함 (like 무전기) 병렬적이지 못한다는 뜻
        
        +) 전이중 모드 : 동시에 양뱡향으로 통신하는 방식
        
    
    이래서 안쓰는듯 싶음
    

### 콜리전 도메인

동시에 허브에 신호를 송신하면 어떻게 될까?

→ 충돌(콜리전)이 발생한다.

허브에 호스트가 많으면 많을수록 발생할 확률이 높음

이러한 충돌 발생 가능 영역을 **콜리전 도메인**이라고 한다

> 충돌 되면 어떻게 되는데?
> 

충돌을 해결하려면  CSMA/CD 프로토콜을 사용하거나 스위치 장비를 써야한다.

- 정리
    
    허브는 여러대 호스트를 연결하는 물리 계층 장비
    전달 받은 신호를 모든 포트로 보내고 반이중 모드 통신
    허브 내 연결된 모든 호스트는 콜리전 도메인에 속하고, 범위가 클 수록 충돌 가능성 증가
    

### CSMA/CD

Carrier Sense Multiple Access with Collision Detection

반이중 이더넷 네트워크에서 충돌을 방지하는 대표적인 프로토콜

> 여러 호스트가 공유하는 통신 매체에 접근할 때 사용 가능한 제어 방식이라는 점에서 매체 접근 제어 방법의 일종이라고도 함
> 
- 역할
1. CS : Carrier Sense 캐리어 감지
    
    정보를 전송하기전에 현재 네트워크 상에서 전송 중인 것이 있는지 먼저 확인하고 사용 가능한지 여부를 검사한다
    
2. MA : Multiple Access 다중 접근
    
    두 개 이상 호스트가 동시에 네트워크를 사용하려 할 때 → 콜리전 발생
    
    복수의 호스트가 접근하려는 상황을 다중 접근이라고 함
    
3. CD : Collision Detection 충돌 검출
    
    충돌 감지 → 전송 중단 → 충돌 발생을 알림 (잼 신호를 보냄)
    
    그러면 임의의 시간 뒤 다시 전송
    

---

## 2-4 스위치

허브의 콜리전을 방지하기위해 CSMA/CD가 있긴 한데

반이중 모드 특성 상 근본적인 해결방법은 될수가 없다… 

전이중 모드라면 상관 없을텐데, BUT 이를 지원하는게 데이터 링크 계층의 스위치임

![image.png](Network%202%20351d02c5e4984476b0e08bcfc0dc72e3/image%201.png)

2계층에서 사용한다고 해서 L2 스위치라고도 함

포트에 호스트 연결 가능 + 특정 MAC 주소의 호스트에게만 데이터를 보낼 수 있음

허브 상위호환이라 이더넷 네트워크 구성시 많이 씀

- 특징
    
    MAC 주소 학습 : 포트의 스트와 MAC주소와의 관계를 기억하는 기능
    
    MAC 주소 테이블 : MAC 주소간 연관 관계를 메모리에 기억하는 표 형태
    
    **근데 어떻게 기억할까?**
    
    처음엔 테이블이 포트만 기억하고 있고 MAC 주소가 매핑이 되어있지 않음
    
    A,B,C,D 네 개의 호스트가 연결되어있다고 하자.
    
    1. A가 C에게 데이터를 보냄
    2. 수신 정보가 스위치를 거치면서 A의 MAC주소를 알게됨
    3. 근데 C의 MAC 주소를 모르니까 송신지 A를 제외한 모든 포트에 보냄
        
        → `플러딩` 이라고 함
        
    4. B랑 D는 상관 없으니까 데이터 폐기
    5. C가 받고 응답 프레임을 스위치로 보냄 (MAC 주소 동봉)
    
    그러면 스위치는 A와 C의 MAC 주소를 알게되어 매핑할 수 있다
    

이제 아는 주소의 데이터는 잘 알아서 보낼 수 있게 됨 몇번의 플러딩을 반복하다보면 전체의 주소를 알 수 있다.

이제 주소를 다 알았다면 골라서 보내야한다. → `필터링` 이라고 함

필터링하고, 정보를 보내야한다 (실제 프레임을 내보내는 것) → `포워딩` 이라고 함

근데 이렇게 계속 테이블을 가지고 있으면 좋겠지만 그렇지 않다.

일정 시간동안 아무 동작을 하지 않으면 그 MAC 주소를 삭제함 → `에이징` 이라고 함

### VLAN

Virtual LAN : 말 그대로 가상의 LAN 만드는 법

하나의 스위치로 여러개의 스위치가 있는 것 처럼 쓸 수 있음

특정 호스트들끼리 묶어서 그룹화 시킨다고 생각하면 좋음

예를들어 개발부 내 공지를 하는데 전체한테 공지할 필요가 없음

→ 개발부 VLAN을 구성해서 공지 날리면 개발부만 받을 수 있음

다른 팀도 받으면 쓸모 없는 연산을 늘릴 뿐임

- VLAN 종류
1. **포트 기반 VLAN**
    
    스위치의 포트가 VLAN을 결성하는 방식
    
    ex) 
    1, 2, 3, 4, 5, 6 포트가 있다고 하면
    
    1, 2 → VLAN 1 / 2, 3 → VLAN 2 / 4, 5 → VLAN 3
    처럼 사전에 특정 포트에 VLAN을 할당하는 방식
    
    **VLAN 트렁킹**
    
    ![image.png](Network%202%20351d02c5e4984476b0e08bcfc0dc72e3/image%202.png)
    
    스위치 하나로 부족할 때, 위 그림과 같은 상황이 펼쳐졌다고 가정하자
    
    `VLAN 트렁킹`은 두 대 이상 VLAN 스위치를 연결하여 확장하는 방식이다.
    
    VLAN끼리 포트를 연결해서 확장할 수 있는데, 3개의 VLAN인 경우 괜찮아 보이지만 VLAN 갯수가 늘고, Host가 더 많다면… 스위치를 사야할것이다….
    
    너무 비효율적이지 않나?
    
    이때 `트렁크 포트` 를 활용하면 한 쌍의 포트만 연결하므로 문제가 해결된다.
    
    ![image.png](Network%202%20351d02c5e4984476b0e08bcfc0dc72e3/80061ee0-5773-4c01-aa0a-11b8d10adc53.png)
    
    VLAN 각각 연결하지 않아도 포트 낭비를 최소한으로 줄일 수 있게 된다.
    
    > ***트렁크 포트로 전달받은 프레임이 어떤 VLAN에 속하는지 파악하는 법***
    > 
    > 
    > 학습되지 않은 MAC 주소에 대해 모르니까 확장된 이더넷 프레임을 사용함
    > 
    > 프리앰플 + 수신지 MAC + 송신지 MAC + 타입/길이 + 페이로드 + 트레일러
    > 
    > 구조에서  
    > 
    > 프리앰플 + 수신지 MAC + 송신지 MAC + VLAN 태그(32비트) + 타입/길이 + 페이로드 + 트레일러
    > 
    > `VLAN 태그` 를 추가해주므로 VLAN을 식별할 수 있게 됨
    > 
    
2. **MAC 기반 VLAN**
    
    송수신하는 프레임 속 MAC 주소가 호스트의 VLAN을 결정하는 방식
    
    고정된 포트가 아니라 호스트의 MAC 주소를 VLAN에 할당하므로 포트를 바꿔도 똑같은 VLAN에 속한다.