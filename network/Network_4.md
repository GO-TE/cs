# Network 4.

---

# 전송 계층

전송계층은 OSI 7계층에서 네트워크와 응용 계층 사이에 있음

전송 계층은 신뢰할 수 있는 통신과 연결형 통신을 가능하게 함

→ IP의 한계 극복, 포트 번호를 통해 응용 계층의 애플리케이션 프로세스를 식별함

### 신뢰할 수 없는 통신과 비연결형 통신

**IP**는 신뢰가 없고 연결 하는 과정이 없는 프로토콜임

`신뢰할수 없는 통신` : 패킷이 수신지까지 제대로 전송되었는지 보장을 안함

`비연결형 통신` : 송수신 호스트 간에 사전 연결 수립 작업을 거치치 않음

빠른 성능을 위해 IP는 이러한 특징을 택했다고 함

### 전송 계층의 보완

1. 전송 계층은 연결형 통신을 지원
    
    `TCP` : 전송 계층의 연결형 프로토콜 
    
    패킷이 수신지까지 올바른 순서대로 확실히 가도록 보장하기 위해 재전송을 통한 오류, 흐름, 혼잡 제어 등을 수행 함
    
2. 신뢰성 있는 통신 가능
    
    마찬가지로 TCP를 통해 지원
    
    `UDP` : 신뢰할 수 없는 통신, 비연결형 통신을 가능하게 하는 전송 계층의 프로토콜
    
    TCP는 하는 일이 많아서 느릴 수 있음 근데, 딱히 저런 역할이 필요 없는 경우도 있음
    
    그럴 때 UDP를 쓴다. 예를 들면 치지직같이 실시간 스트리밍이라면 패킷이 한두개정도 손실되도 괜찮음
    

### 포트

`포트` : 특정 애플리케이션이 패킷을 전달받기 위한 식별 정보

라우팅되서 호스트가 패킷을 받은게 끝이 아니라 프로세스에 전달되서 데이터를 처리해야 의미 있지 않을까?

TCP와 UDP는 포트 번호를 포함하고, 포트 번호는 16비트로 0~65535까지 가능

| 종류 | 범위 |
| --- | --- |
| 잘 알려진 포트 | 0~1023 |
| 등록된 포트 | 1024~49151 |
| 동적 포트 | 49152~65535 |
- Well Known Port
    
    시스템 포트라고도 함. 국룰 포트라고 보면 편함
    
    | port number | description |
    | --- | --- |
    | 20, 21 | FTP |
    | 22 | SSH |
    | 23 | TELNET |
    | 53 | DNS |
    | 67, 68 | DHCP |
    | 80 | HTTP |
    | 443 | HTTPS |
- registered port
    
    덜 범용적인데, 흔히 사용되는 애플리케이션에 할당하기 위해 사용
    
- dynamic port
    
    인터넷 할당 번호 관리 기관에 의해 할당된 애플리케이션 프로토콜이 없고 특별히 관리 되지 않아 자유롭게 사용 가능
    

서버로 동작하는 프로그램은 일반적으로 포트가 암묵적으로 정해져있음

클라이언트가 동작하는 프로그램은 포드번호가 임의인 경우가 많음

이렇게 서로 포트 번호로 패킷을 송수신함

`IP주소 : 포트 번호` 형식으로 표기됨

### 포트 기반 NAT

`NAT` : IP 주소를 변환하는 기술 : 네트워크 내부 사설 IP를 외부 공인 IP로 변환

`NAT 변환 테이블` : NAT로 바꾼 IP를 저장한 테이블

![image.png](Network%204%20d87f5adf5a484c8185a4b3e33218517c/image.png)

| 네트워크 외부 | 네트워크 내부 |
| --- | --- |
| 1.2.3.4 | 192.168.0.5 |

NAT 변환 테이블이 위처럼 있다면

네트워크 외부에서 1.2.3.4에 송신을 함 → 라우터가 변환해서 192.168.0.5로 변환

근데 공인 IP와 사설 IP는 1:1로 대응하지 않음 (사설 IP만큼 공인 IP도 많이 필요해서…)

1:N으로 가능하도록 하는게 포트임

### NAPT

포트 기반의 NAT를 NAPT라고 함

위에서 언급했듯, `IP : 포트` 이 방식으로 NAT 테이블을 관리해서 한 아이피로 여러 사설 아이피가 쓸 수 있도록 함

### 포트포워딩

네트워크 내 특정 호스트에 IP 주소와 포트 번호를 미리 배정하고 해당 IP:포트로 해당 호스트에서 패킷을 전달하는 기술

외부에서 통신을 할 때, 해당 IP와 포트 번호로 통신할 수 있도록 해줌

### ICMP

IP 패킷의 전송 과정에 대한 피드백 메세지를 얻기 위해 쓰는 프로토콜

[전송 과정 문제 오류 리포팅, 네트워크 진단 정보] 로 구성되어 있음

## TCP

위에 언급했듯이, 신뢰할 수 있는 통신을 위한 연결형 프로토콜

### TCP 통신 단계

연결 수립 → 데이터 송수신 → 연결 종료

### TCP 세그먼트

`MMS` : Maximum Segment Size, TCP로 전송할 수 있는 최대 페이로드 크기

[이더넷 헤더, IP 헤더, TCP 헤더, 페이로드, FCS]

![정보통신기술용어해설](Network%204%20d87f5adf5a484c8185a4b3e33218517c/image%201.png)

정보통신기술용어해설

Sequence Number : 순서 번호가 명시되는 필드 : 순서 번호 - 세그먼트의 순서를 위함

Acknowledgement number : 상대 호스트가 보낸 세그먼트에 대한 응답 : 다음 수신을 위한 순서 번호가 명시

제어 비트 (예약과 윈도우 사이즈 사이) : 현재 세그먼트에 대한 부가 정보

윈도우 사이즈 : 수신 윈도우의 크기가 명시 : 수신 윈도우 - 한 번에 수신 되는 데이터 양

> **제어 비트**
> 
> 
> 기본적으로 8비트임, 1이면 해당 속성임을 알림
> 
> ex) 00000001 : 종료임을 알리는 비트
> 
> **CWR** : Congestion Window Reduced : ECE 비트를 수신한 송신 프로세스가 전송 윈도우 크기를 줄였음을 알림
> 
> **ECE** : ECN Echo : 네트워크 트래픽이 많을 때 라우터가 송신 프로세스에 명시적으로 혼잡 임을 알림
> 
> **URG** : Urgent Pointer :  긴급 데이터로 순서에 상관없이 먼저 송신됨
> 
> **ACK** : 세그먼트 승인을 알림
> 
> **PSH** : Push : 버퍼링된 데이터를 가능한 빨리 상위 계층에 즉시 전달함을 림
> 
> **RST** : Reset : 연결된 회선에 강제 리셋 요청
> 
> **SYN** : Synchronize : TCP 연결 설정 초기화를 위한 순서 번호의 동기화
> 
> **FIN** : Finish : 데이터 송신의 끝마침을 알림
>